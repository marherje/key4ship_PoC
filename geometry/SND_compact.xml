<lccdd xmlns:compact="http://www.lcsim.org/schemas/compact/1.0"
       xmlns:xs="http://www.w3.org/2001/XMLSchema"
       xs:noNamespaceSchemaLocation="http://www.lcsim.org/schemas/compact/1.0/compact.xsd">

  <info name="SND_sim_poc" title="SND simulation proof-of-concept" author="J.P. Marquez"
        url="" status="development" version="1.0">
    <comment> key4hep 2026-02-01 compatible </comment>
  </info>

  <includes>
    <gdmlFile ref="elements.xml"/>
    <gdmlFile ref="materials.xml"/>
  </includes>

  <define>
    <!-- World -->
    <constant name="world_side" value="2*m"/>
    <constant name="world_x"    value="world_side"/>
    <constant name="world_y"    value="world_side"/>
    <constant name="world_z"    value="world_side"/>

    <!-- Required by DD4hep tracking region -->
    <constant name="tracker_region_rmax" value="0*mm"/>
    <constant name="tracker_region_zmax" value="0*mm"/>

    <!-- ECAL geometry constants (from ECAL_commondefs.xml) -->
    <constant name="env_safety"              value="0.001*mm"/>

    <constant name="Ecal_NcellsX"            value="32"/>
    <constant name="Ecal_NcellsY"            value="32"/>
    <constant name="Ecal_CellSizeX"          value="5.5*mm"/>
    <constant name="Ecal_CellSizeY"          value="5.5*mm"/>

    <constant name="Ecal_dim_x"              value="Ecal_NcellsX*Ecal_CellSizeX"/>
    <constant name="Ecal_dim_y"              value="Ecal_NcellsY*Ecal_CellSizeY"/>
    <constant name="Ecal_dim_z"              value="330*mm"/>

    <constant name="Ecal_AlThickness"        value="2*mm"/>
    <constant name="Ecal_WThickness"         value="1*mm"/>
    <constant name="Ecal_CFThickness"        value="1.5*mm"/>
    <constant name="Ecal_KaptonThickness"    value="0.1*mm"/>
    <constant name="Ecal_GlueThickness_kap"  value="0.1*mm"/>
    <constant name="Ecal_GlueThickness_pcb"  value="0.1*mm"/>
    <constant name="Ecal_WaferThickness320"  value="0.320*mm"/>
    <constant name="Ecal_WaferThickness500"  value="0.500*mm"/>
    <constant name="Ecal_WaferThickness650"  value="0.650*mm"/>
    <constant name="Ecal_PcbThickness"       value="1.7*mm"/>
    <constant name="Ecal_ChipThickness"      value="1.2*mm"/>

    <constant name="Ecal_slab_thickness320"  value="10.72*mm"/>
    <constant name="Ecal_slab_thickness500"  value="10.9*mm"/>
    <constant name="Ecal_slab_thickness650"  value="11.05*mm"/>
    <constant name="Ecal_LayerDistance"      value="15.0*mm"/>

    <constant name="Ecal_w_slab_gap320"  value="Ecal_LayerDistance-Ecal_slab_thickness320"/>
    <constant name="Ecal_w_slab_gap500"  value="Ecal_LayerDistance-Ecal_slab_thickness500"/>
    <constant name="Ecal_w_slab_gap650"  value="Ecal_LayerDistance-Ecal_slab_thickness650"/>

    <constant name="Ecal_TB_box_z"       value="Ecal_dim_z+2*59.7*mm+2*Ecal_AlThickness"/>
    <constant name="total_preshower_estimation" value="1.443"/>

    <!-- SiTarget constants (from FairShip SiliconTarget_config.yaml) -->
    <constant name="SiTarget_n_layers"       value="10"/>
    <constant name="SiTarget_absorber_thick" value="3.5*mm"/>
    <constant name="SiTarget_layer_pitch"    value="11*mm"/>
    <constant name="SiTarget_module_offset"  value="1*mm"/>
    <constant name="SiTarget_sensor_width"   value="98*mm"/>
    <constant name="SiTarget_sensor_length"  value="195.2*mm"/>
    <constant name="SiTarget_sensor_thickness" value="0.3*mm"/>
    <constant name="SiTarget_env_width"      value="400*mm"/>
    <constant name="SiTarget_env_height"     value="400*mm"/>
    <constant name="SiTarget_z_position"     value="-300*mm"/>
  </define>

  <limits>
    <limitset name="cal_limits">
      <limit name="step_length_max" particles="*" value="5.0" unit="mm"/>
    </limitset>
  </limits>

  <display>
    <vis name="Invisible"    alpha="0.0" r="0"   g="0"    b="0"    showDaughters="false" visible="false"/>
    <vis name="EcalVis"      alpha="0.5" r="0.7" g="0.7"  b="0.0"  showDaughters="true"  visible="false"/>
    <vis name="TungstenVis"  alpha="1.0" r="0.5" g="0.35" b="0.55" showDaughters="true"  visible="true"/>
    <vis name="AirVis"       alpha="1.0" r="0.0" g="1.0"  b="0.0"  showDaughters="true"  visible="false"/>
    <vis name="SiVis"        alpha="1.0" r="0.9" g="0.9"  b="0.9"  showDaughters="true"  visible="true"/>
    <vis name="AlVis"        alpha="1.0" r="0.7" g="0.7"  b="0.7"  showDaughters="true"  visible="true"/>
    <vis name="PCBVis"       alpha="1.0" r="0.0" g="0.8"  b="0.0"  showDaughters="true"  visible="true"/>
    <vis name="CFVis"        alpha="0.5" r="0.0" g="0.0"  b="0.0"  showDaughters="true"  visible="false"/>
    <vis name="CuVis"        alpha="0.5" r="1.0" g="0.5"  b="0.0"  showDaughters="true"  visible="false"/>
  </display>

  <readouts>
    <readout name="SiPixelHits">
      <segmentation type="CartesianGridXY"
                    grid_size_x="Ecal_CellSizeX"
                    grid_size_y="Ecal_CellSizeY"
                    offset_x="-85.25*mm"
                    offset_y="-85.25*mm"/>
      <id>system:8,layer:8,slice:4,x:16,y:16</id>
    </readout>

    <readout name="SiTargetHits">
      <segmentation type="CartesianGridXY"
                    grid_size_x="0.0755*mm"
                    grid_size_y="391.4*mm"
                    offset_x="-197.5*mm"
                    offset_y="-195.7*mm"/>
      <id>system:8,layer:8,plane:2,x:13,y:1</id>
    </readout>
  </readouts>

  <detectors>
    <include ref="SiPixelDetector.xml"/> 

    <detector name="SiTarget" type="SiTargetDetector" id="5" readout="SiTargetHits">
      <parameters n_layers="SiTarget_n_layers"
                  target_thickness="SiTarget_absorber_thick"
                  target_spacing="SiTarget_layer_pitch"
                  module_offset="SiTarget_module_offset"
                  sensor_width="SiTarget_sensor_width"
                  sensor_length="SiTarget_sensor_length"
                  sensor_thickness="SiTarget_sensor_thickness"
                  env_width="SiTarget_env_width"
                  env_height="SiTarget_env_height"
                  z_position="SiTarget_z_position"
                  absorber_material="TungstenDens1910"
                  sensor_material="Silicon"/>
    </detector>
  </detectors>

</lccdd>
